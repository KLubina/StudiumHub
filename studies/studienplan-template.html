<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Studienplan</title>

    <!-- Base CSS (Layout-Grundgerüst) -->
    <link rel="stylesheet" href="css/studienplan-base.css">

    <!-- NEU: Theme CSS (Gemeinsame Styles) - wird dynamisch geladen -->
    <link rel="stylesheet" id="theme-core-css" href="">
    <link rel="stylesheet" id="theme-variables-css" href="">
    <link rel="stylesheet" id="theme-colors-css" href="">

    <!-- Custom CSS (Studiengang-spezifische Features) -->
    <link rel="stylesheet" id="custom-css" href="">
</head>

<body data-studiengang="">
    <!-- Zurück zum Hub Button -->
    <div class="hub-button-container">
        <a href="../index.html" class="hub-button">← Zurück zum Hub</a>
    </div>

    <h1 id="studienplan-title">Studienplan</h1>
    <h2 id="studienplan-subtitle">mind. 180 KP insgesamt</h2>

    <!-- Major/Minor Selector (nur für major-minor Studiengänge) -->
    <div id="major-minor-selector" class="major-minor-selector" style="display: none;">
        <!-- JavaScript wird hier den Selector einfügen -->
    </div>

    <div class="container">
        <div class="studienplan" id="studienplan">
            <!-- JavaScript wird hier die Jahre und Module einfügen -->
        </div>

        <!-- Farben-Legende -->
        <div class="farben-legende">
            <div class="legende-titel" id="legende-titel">Farben-Legende</div>
            <div id="legende">
                <!-- JavaScript wird hier die Legende einfügen -->
            </div>
        </div>
    </div>

    <!-- Tooltip-Container -->
    <div id="tooltip" class="tooltip-container" style="display: none;"></div>

    <!-- Base JavaScript -->
    <script src="js/studienplan-base-loader.js"></script>
    <script src="js/modular-config-loader.js"></script>

    <script>
        // URL Parameter auslesen
        const urlParams = new URLSearchParams(window.location.search);
        const studiengang = urlParams.get('studiengang') || 'eth-cs';

        // NEU: Data-Attribut setzen für CSS-Variablen
        document.body.setAttribute('data-studiengang', studiengang);

        // Bestimme ob major-minor oder mono Modell
        const majorMinorPrograms = ['sozwi'];
        const studyModel = majorMinorPrograms.includes(studiengang) ? 'major-minor' : 'mono';

        // Theme CSS laden
        const themeCoreCSS = document.getElementById('theme-core-css');
        const themeVariablesCSS = document.getElementById('theme-variables-css');
        const themeColorsCSS = document.getElementById('theme-colors-css');

        themeCoreCSS.href = `css/${studyModel}/themes/theme-core.css`;
        themeVariablesCSS.href = `css/${studyModel}/themes/theme-variables.css`;
        themeColorsCSS.href = `css/${studyModel}/themes/theme-colors.css`;

        // Custom CSS laden
        const customCSS = document.getElementById('custom-css');
        customCSS.href = `css/${studyModel}/custom/${studiengang}-custom.css`;

        // Error handling falls Datei nicht existiert
        customCSS.onerror = () => {
        };

        // Extension-Module laden (wie vorher)
        async function loadExtensionModules(studiengang) {
            const extensionModules = [
                'extensions-data',
                'extensions-kp-counter',
                'extensions-tooltips',
                'extensions-utils'
            ];

            const hasExtensions = ['eth-itet', 'eth-cse', 'eth-rig'].includes(studiengang);

            if (hasExtensions) {
                // Bestimme ob major-minor oder mono Modell
                const majorMinorPrograms = ['sozwi'];
                const studyModel = majorMinorPrograms.includes(studiengang) ? 'major-minor' : 'mono';

                for (const module of extensionModules) {
                    const script = document.createElement('script');
                    script.src = `js/${studyModel}/configs/${studiengang}/${module}.js`;

                    await new Promise((resolve) => {
                        script.onload = () => {
                            resolve();
                        };
                        script.onerror = () => {
                            resolve();
                        };
                        document.head.appendChild(script);
                        setTimeout(resolve, 100);
                    });
                }
            }
        }

        // DOM Ready
        document.addEventListener('DOMContentLoaded', async function () {

            await loadExtensionModules(studiengang);

            window.loadStudiengangConfig(studiengang);
        });
    </script>
</body>
</html>