<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Studienplan</title>

    <!-- Base CSS (Layout-Grundger√ºst) -->
    <link rel="stylesheet" href="css/studienplan-base.css">
    
    <!-- NEU: Theme CSS (Gemeinsame Styles) -->
    <link rel="stylesheet" href="css/themes/theme-core.css">
    <link rel="stylesheet" href="css/themes/theme-variables.css">
    <link rel="stylesheet" href="css/themes/theme-colors.css">
    
    <!-- Custom CSS (Studiengang-spezifische Features) -->
    <link rel="stylesheet" id="custom-css" href="">
</head>

<body data-studiengang="">
    <!-- Zur√ºck zum Hub Button -->
    <div class="hub-button-container">
        <a href="../index.html" class="hub-button">‚Üê Zur√ºck zum Hub</a>
    </div>

    <h1 id="studienplan-title">Studienplan</h1>
    <h2 id="studienplan-subtitle">mind. 180 KP insgesamt</h2>

    <div class="container">
        <div class="studienplan" id="studienplan">
            <!-- JavaScript wird hier die Jahre und Module einf√ºgen -->
        </div>

        <!-- Farben-Legende -->
        <div class="farben-legende">
            <div class="legende-titel" id="legende-titel">Farben-Legende</div>
            <div id="legende">
                <!-- JavaScript wird hier die Legende einf√ºgen -->
            </div>
        </div>
    </div>

    <!-- Tooltip-Container -->
    <div id="tooltip" class="tooltip-container" style="display: none;"></div>

    <!-- Base JavaScript -->
    <script src="js/studienplan-base-loader.js"></script>
    <script src="js/modular-config-loader.js"></script>

    <script>
        // URL Parameter auslesen
        const urlParams = new URLSearchParams(window.location.search);
        const studiengang = urlParams.get('studiengang') || 'cs';

        console.log(`üéØ Studiengang: ${studiengang}`);

        // NEU: Data-Attribut setzen f√ºr CSS-Variablen
        document.body.setAttribute('data-studiengang', studiengang);

        // Custom CSS laden
        const customCSS = document.getElementById('custom-css');
        customCSS.href = `css/custom/${studiengang}-custom.css`;
        
        // Error handling falls Datei nicht existiert
        customCSS.onerror = () => {
            console.log(`Keine custom CSS f√ºr ${studiengang}`);
        };

        // Extension-Module laden (wie vorher)
        async function loadExtensionModules(studiengang) {
            const extensionModules = [
                'extensions-data',
                'extensions-kp-counter',
                'extensions-tooltips',
                'extensions-utils'
            ];

            const hasExtensions = ['itet', 'cse', 'rig'].includes(studiengang);

            if (hasExtensions) {
                console.log(`üì¶ Lade Extension-Module f√ºr ${studiengang}...`);

                for (const module of extensionModules) {
                    const script = document.createElement('script');
                    script.src = `js/configs/${studiengang}/${module}.js`;
                    
                    await new Promise((resolve) => {
                        script.onload = () => {
                            console.log(`‚úÖ ${module}.js geladen`);
                            resolve();
                        };
                        script.onerror = () => {
                            console.log(`‚è≠Ô∏è ${module}.js nicht gefunden`);
                            resolve();
                        };
                        document.head.appendChild(script);
                        setTimeout(resolve, 100);
                    });
                }
            }
        }

        // DOM Ready
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('üìÑ DOM geladen');

            await loadExtensionModules(studiengang);

            window.loadStudiengangConfig(studiengang);
        });
    </script>
</body>
</html>