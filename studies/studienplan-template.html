<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Studienplan</title>

    <!-- ==== CORE CSS ==== -->
    <link rel="stylesheet" href="css/core/variables.css">
    <link rel="stylesheet" href="css/core/layout.css">
    <link rel="stylesheet" href="css/core/typography.css">

    <!-- ==== COMPONENTS CSS ==== -->
    <link rel="stylesheet" href="css/components/hub-button.css">
    <link rel="stylesheet" href="css/components/study-links.css">
    <link rel="stylesheet" href="css/components/module.css">
    <link rel="stylesheet" href="css/components/legend.css">
    <link rel="stylesheet" href="css/components/tooltip.css">
    <link rel="stylesheet" href="css/components/kp-counter.css">
    <link rel="stylesheet" href="css/components/controls.css">
    <link rel="stylesheet" href="css/components/module-lists.css">
    <link rel="stylesheet" href="css/components/indicators.css">
    <link rel="stylesheet" href="css/components/major-minor-selector.css">

    <!-- ==== THEMES CSS (loaded dynamically) ==== -->
    <link rel="stylesheet" href="css/themes/color-variables.css">
    <link rel="stylesheet" id="theme-css" href="">

    <!-- ==== PROGRAM-SPECIFIC CSS (loaded dynamically) ==== -->
    <link rel="stylesheet" id="uzh-shared-css" href="">
    <link rel="stylesheet" id="program-css" href="">
</head>

<body data-studiengang="">
    <!-- Zurück zum Hub Button -->
    <div class="hub-button-container">
        <a href="../index.html" class="hub-button">← Zurück zum Hub</a>
    </div>

    <h1 id="studienplan-title">Studienplan</h1>
    <h2 id="studienplan-subtitle">mind. 180 KP insgesamt</h2>

    <!-- Major/Minor Selector (nur für major-minor Studiengänge) -->
    <div id="major-minor-selector" class="major-minor-selector" style="display: none;">
        <!-- JavaScript wird hier den Selector einfügen -->
    </div>

    <div class="container">
        <div class="studienplan" id="studienplan">
            <!-- JavaScript wird hier die Jahre und Module einfügen -->
        </div>

        <!-- Farben-Legende -->
        <div class="farben-legende">
            <div class="legende-titel" id="legende-titel">Farben-Legende</div>
            <div id="legende">
                <!-- JavaScript wird hier die Legende einfügen -->
            </div>
        </div>
    </div>

    <!-- Tooltip-Container -->
    <div id="tooltip" class="tooltip-container" style="display: none;"></div>

    <!-- Base JavaScript -->
    <script src="js/studienplan-base-loader.js"></script>
    <script src="js/modular-config-loader.js"></script>

    <script>
        // URL Parameter auslesen
        const urlParams = new URLSearchParams(window.location.search);
        const studiengang = urlParams.get('studiengang') || 'eth-cs';

        // NEU: Data-Attribut setzen für CSS-Variablen
        document.body.setAttribute('data-studiengang', studiengang);

        // Bestimme ob major-minor oder mono Modell
        const majorMinorPrograms = ['sozwi', 'uzh-geschichte', 'uzh-polisci', 'uzh-ethnologie',
                                    'uzh-kommunikation', 'uzh-pop-kultur', 'uzh-soziologie'];
        const studyModel = majorMinorPrograms.includes(studiengang) ? 'major-minor' : 'mono';

        // Theme CSS laden (mono oder major-minor)
        const themeCSS = document.getElementById('theme-css');
        themeCSS.href = `css/themes/${studyModel}-theme.css`;

        // UZH Shared CSS laden (nur für UZH Programme)
        const uzhSharedCSS = document.getElementById('uzh-shared-css');
        if (studiengang.startsWith('uzh-')) {
            uzhSharedCSS.href = `css/programs/major-minor/uzh-shared.css`;
        }

        // Program-specific CSS laden
        const programCSS = document.getElementById('program-css');
        programCSS.href = `css/programs/${studyModel}/${studiengang}.css`;

        // Error handling falls Datei nicht existiert
        programCSS.onerror = () => {
            console.log(`No program-specific CSS found for ${studiengang}`);
        };

        // Extension-Module laden (wie vorher)
        async function loadExtensionModules(studiengang) {
            const extensionModules = [
                'extensions-data',
                'extensions-kp-counter',
                'extensions-tooltips',
                'extensions-utils'
            ];

            const hasExtensions = ['eth-itet', 'eth-cse', 'eth-rig'].includes(studiengang);

            if (hasExtensions) {
                // Bestimme ob major-minor oder mono Modell
                const majorMinorPrograms = ['sozwi'];
                const studyModel = majorMinorPrograms.includes(studiengang) ? 'major-minor' : 'mono';

                for (const module of extensionModules) {
                    const script = document.createElement('script');
                    script.src = `js/${studyModel}/configs/${studiengang}/${module}.js`;

                    await new Promise((resolve) => {
                        script.onload = () => {
                            resolve();
                        };
                        script.onerror = () => {
                            resolve();
                        };
                        document.head.appendChild(script);
                        setTimeout(resolve, 100);
                    });
                }
            }
        }

        // DOM Ready
        document.addEventListener('DOMContentLoaded', async function () {

            await loadExtensionModules(studiengang);

            window.loadStudiengangConfig(studiengang);
        });
    </script>
</body>
</html>